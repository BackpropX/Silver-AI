<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Silver</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/silver.css">
    <script src="https://js.puter.com/v2/"></script>
</head>

<body>
  <div id="chat-container">
    <div id="messages"></div>
    <div id="chat-input">
      <input type="text" id="input-message" placeholder="Type a message...">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
  <p>Created using Puter.JS</p>

  <script>
    const messages = [
      { content: "My name is not ChatGPT, I am Silver AI", role: 'system' }
    ];

    function addMessage(msg, isUser) {
      const messagesDiv = document.getElementById("messages");
      const messageDiv = document.createElement("div");
      messageDiv.classList.add("message");
      if (isUser) {
        messageDiv.classList.add("user-message");
      }
      messageDiv.innerHTML = msg; // Use innerHTML to support HTML content
      messagesDiv.appendChild(messageDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function sendMessage() {
      const input = document.getElementById("input-message");
      const message = input.value.trim();
      if (message) {
        addMessage(message, true);
        input.value = '';
        // Record the message in array of messages
        messages.push({
          content: message,
          role: 'user'
        });

        (async () => {
          try {
            const response = await puter.ai.chat(messages, {
              model: 'gpt-4o-mini',
              stream: true
            });
            let fullResponse = '';
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("message");
            document.getElementById("messages").appendChild(messageDiv);
            for await (const part of response) {
              fullResponse += part?.text?.replaceAll('\n', '<br>');
              messageDiv.innerHTML = fullResponse;
              messageDiv.scrollTop = messageDiv.scrollHeight;
            }
            messages.push({ content: fullResponse, role: 'assistant' });
          } catch (error) {
            console.error('An error occurred:', error);
            addMessage('An error occurred while processing your request. Please try again.', false);
          }
        })();
      }
    }
  </script>
</body>

</html>